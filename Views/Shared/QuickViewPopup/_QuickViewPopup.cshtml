
<div class="modal fade quick-view-popup" id="content_quickview">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div id="ProductSection-product-template" class="product-template__container prstyle1">
                    <div class="product-single">
                        <!-- Start model close -->
                        <a href="javascript:void()" data-dismiss="modal" class="model-close-btn pull-right" title="close"><span class="icon icon anm anm-times-l"></span></a>
                        <!-- End model close -->
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                                <div class="product-details-img">
                                    <div class="pl-20">
                                        <img class="img-fluid" id="quickview-product-img" width="100%" src="assets/images/product-detail-page/camelia-reversible-big1.jpg" alt="" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                                <div class="product-single__meta">
                                    <h2 class="product-single__title">Product Quick View Popup</h2>
                                    <div class="prInfoRow">
                                        <div class="product-stock"> <span class="instock ">In Stock</span> <span class="outstock hide">Unavailable</span> </div>
                                        <div class="product-sku">SKU: <span id="product-skucode" class="variant-sku">19115-rdxs</span></div>
                                    </div>
                                    <p class="product-single__price product-single__price-product-template">
                                        <span class="visually-hidden">Regular price</span>
                                        <span class="product-price__price product-price__price-product-template product-price__sale product-price__sale--single">
                                            <span id="ProductPrice-product-template"><span class="money">$500.00</span></span>
                                        </span>
                                    </p>
                                    <div class="product-single__description rte">
                                        Belle Multipurpose Bootstrap 4 Html Template that will give you and your customers a smooth shopping experience which can be used for various kinds of stores such as fashion,...
                                    </div>

                                    <form method="post" asp-controller="Cart" asp-action="AddToCart" id="product_form_10508262282" accept-charset="UTF-8" class="product-form product-form-product-template hidedropdown" enctype="multipart/form-data">
                                        <input hidden id="productId" name="productId" />
                                        <div class="swatch clearfix swatch-0 option1" data-option-index="0">
                                            <div class="product-form__item" id="product-color-wrapper">
                                                <label class="header">Color: <span id="selectColor" class="slVariant">Chưa chọn</span></label>
                                                
                                                <div data-value="Blue" class="swatch-element color blue available">
                                                    <input class="swatchInput" id="swatch-0-blue" type="radio" name="option-0" value="Blue">
                                                    <label class="swatchLbl color medium rectangle" for="swatch-0-blue" style="background-image:url(assets/images/product-detail-page/variant1-2.jpg);" title="Blue"></label>
                                                </div>
                                                <div data-value="Green" class="swatch-element color green available">
                                                    <input class="swatchInput" id="swatch-0-green" type="radio" name="option-0" value="Green">
                                                    <label class="swatchLbl color medium rectangle" for="swatch-0-green" style="background-image:url(assets/images/product-detail-page/variant1-3.jpg);" title="Green"></label>
                                                </div>
                                                <div data-value="Gray" class="swatch-element color gray available">
                                                    <input class="swatchInput" id="swatch-0-gray" type="radio" name="option-0" value="Gray">
                                                    <label class="swatchLbl color medium rectangle" for="swatch-0-gray" style="background-image:url(assets/images/product-detail-page/variant1-4.jpg);" title="Gray"></label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="swatch clearfix swatch-1 option2" data-option-index="1">
                                            <div class="product-form__item" id="wrapper-size">
                                                <label class="header">Size: <span id="selectSize" class="slVariant">Chưa chọn</span></label>
                                                <div data-value="XS" class="swatch-element xs available">
                                                    <input class="swatchInput" id="swatch-1-xs" type="radio" name="option-1" value="XS">
                                                    <label class="swatchLbl medium rectangle" for="swatch-1-xs" title="XS">XS</label>
                                                </div>
                                                <div data-value="S" class="swatch-element s available">
                                                    <input class="swatchInput" id="swatch-1-s" type="radio" name="option-1" value="S">
                                                    <label class="swatchLbl medium rectangle" for="swatch-1-s" title="S">S</label>
                                                </div>
                                                <div data-value="M" class="swatch-element m available">
                                                    <input class="swatchInput" id="swatch-1-m" type="radio" name="option-1" value="M">
                                                    <label class="swatchLbl medium rectangle" for="swatch-1-m" title="M">M</label>
                                                </div>
                                                <div data-value="L" class="swatch-element l available">
                                                    <input class="swatchInput" id="swatch-1-l" type="radio" name="option-1" value="L">
                                                    <label class="swatchLbl medium rectangle" for="swatch-1-l" title="L">L</label>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Product Action -->
                                        <div class="product-action clearfix">
                                            <div class="product-form__item--quantity">
                                                <div class="wrapQtyBtn">
                                                    <div id="quickview-qty" class="qtyField">
                                                        <a class="quick-view-qty qtyBtn minus" href="javascript:void(0);"><i class="fa anm anm-minus-r" aria-hidden="true"></i></a>
                                                        <input type="text" id="Quantity" name="quantity" value="1" class="product-form__input qty">
                                                        <a class="quick-view-qty qtyBtn plus" href="javascript:void(0);"><i class="fa anm anm-plus-r" aria-hidden="true"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="product-form__item--submit">
                                                <button id="btn-add-to-cart" type="submit" disabled name="add" class="btn product-form__cart-submit">
                                                    <span>Add to cart</span>
                                                </button>
                                            </div>
                                        </div>
                                        <!-- End Product Action -->
                                    </form>
                                    <div class="display-table shareRow">
                                        <div class="display-table-cell">
                                            <div class="wishlist-btn">
                                                <a class="wishlist add-to-wishlist" href="#" title="Add to Wishlist"><i class="icon anm anm-heart-l" aria-hidden="true"></i> <span>Add to Wishlist</span></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--End-product-single-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>




<script>

    function formatVND(amount) {
        return amount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
    }


    $('#content_quickview').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var productId = button.data('product-id');
        var modal = $(this);
        modal.find('.product-single__title').text(productId);

        callApiProduct(productId)

    });

    async function callApiProduct(id) {
        const response = await fetch("/api/Product/" + id);
        const responseData = await response.json();

        console.log(responseData)
        renderQuickViewPopup(responseData)
    }

    function renderQuickViewPopup(data) {

        const productIdTag = document.getElementById('productId')
        console.log(productIdTag)
        productIdTag.value = data.product.id;


        const imageTag = document.getElementById('quickview-product-img')
        imageTag.src = data.product.thumbnail;
        
        const productNameTag = document.querySelector('.product-single__title')
        productNameTag.innerText = data.product.name;

        const skuCodeTag = document.getElementById('product-skucode')
        skuCodeTag.innerText = data.product.id


        const colorWrapper = document.getElementById('product-color-wrapper')
        colorWrapper.innerHTML = '<label class="header">Color: <span id="selectColor" class="slVariant">Chưa chọn</span></label>'

        document.getElementById('ProductPrice-product-template').innerText = formatVND(data.product.price);

        data.colors.forEach(color => {
            let html = `
                    <div data-value="${color.id}" class="swatch-element color red available">
                                <input class="swatchInput" id="swatch-0-${color.id}" data-name=${color.name} type="radio" name="colorId" value="${color.id}">
                                    <label class="swatchLbl color medium rectangle" for="swatch-0-${color.id}" style="background-color:${color.hexCode}" title="${color.name}"></label>
                    </div>
            `

            colorWrapper.innerHTML += html;
        })

        const sizeWrapper = document.getElementById('wrapper-size')
        sizeWrapper.innerHTML = ' <label class="header">Size: <span id="selectSize" class="slVariant">Chưa chọn</span></label>'

        data.sizes.forEach(size => {
            let html = `
                    <div data-value="${size.id}" class="swatch-element xs available">
                                     <input class="swatchInput" id="swatch-1-${size.id}" data-name=${size.eSize} type="radio" name="sizeId" value="${size.id}">
                                           <label class="swatchLbl medium rectangle" for="swatch-1-${size.id}" title="${size.eSize}">${size.eSize}</label>
                    </div>
                         
                `

            sizeWrapper.innerHTML += html;
        })

        assignEvents();
    }


    const btnSubmit = document.getElementById('btn-add-to-cart')

    function assignEvents() {
        const colorInputs = document.querySelectorAll('input[name="colorId"]');
        colorInputs.forEach(colorInput => {
            colorInput.addEventListener('change', handleInputChange)
        })
    }
        
    const handleInputChange = async (e) => {

        var skuCodeTag = document.getElementById('product-skucode')
        var selectedColor = document.querySelector('input[name="colorId"]:checked');
        var selectedSize = document.querySelector('input[name="sizeId"]:checked');

        const selectColorTag = document.getElementById('selectColor');
        const selectSizeTag = document.getElementById('selectSize');

        if (selectedSize) {
            selectSizeTag.innerText = selectedSize.getAttribute('data-name')
        }

        if (selectedColor && selectedSize) {
            selectColorTag.innerText = selectedColor.getAttribute('data-name')
            btnSubmit.disabled = false;
            return;
        } else {
            btnSubmit.disabled = true;
        }


        if (selectedColor) {
            var colorValue = selectedColor.value;
            selectColorTag.innerText = selectedColor.getAttribute('data-name')

            console.log('COLOR HERE')
            const payload = {
                'colorId': parseInt(colorValue),
                'productId': parseInt(skuCodeTag.innerText.trim())
            }

            const response = await fetch('/Product/GetSizesByColor', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })

            const responseData = await response.json()
            render(responseData)

        }

    }


    function render(data) {
       
        const quickViewProductImage = document.getElementById('quickview-product-img')
        quickViewProductImage.src = data.images[0].url

        var wrapperSize = document.getElementById('wrapper-size')

        wrapperSize.innerHTML = '<label class="header">Size: <span id="selectSize" class="slVariant">Chưa chọn</span></label>';

        data.sizes.forEach(item => {
            let html = `
                <div data-value="${item.eSize}" class="swatch-element xs available">
                            <input class="swatchInput" id="swatch-1-${item.eSize}" data-name=${item.eSize} type="radio" name="sizeId" value="${item.id}">
                    <label class="swatchLbl small flat" for="swatch-1-${item.eSize}" title="${item.eSize}">${item.eSize}</label>
                </div>
            `

            wrapperSize.innerHTML += html;
        })

        const sizeInputs = document.querySelectorAll('input[name="sizeId"]');
        sizeInputs.forEach(sizeInput => {
            sizeInput.addEventListener('change', handleInputChange)
        })
    }

</script>
